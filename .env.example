# ============================================
# miniWiki Environment Configuration
# ============================================
# Copy this file to .env and fill in the values
# Never commit .env to version control!

# ============================================
# Database Configuration
# ============================================
POSTGRES_USER=miniwiki
POSTGRES_PASSWORD=change_this_secure_password_in_production
POSTGRES_DB=miniwiki
POSTGRES_HOST=localhost
POSTGRES_PORT=5432

# Connection Pool Configuration
# Recommended values: min_connections=5, max_connections=20 for production
DB_MIN_CONNECTIONS=5
DB_MAX_CONNECTIONS=20
DB_CONNECTION_TIMEOUT=30

# Build DATABASE_URL with pool settings (applied by config.rs)
DATABASE_URL=postgres://miniwiki:change_this_secure_password_in_production@localhost:5432/miniwiki

# ============================================
# Redis Configuration
# ============================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_URL=redis://localhost:6379

# Redis Cache Configuration
# Cache TTL (time-to-live) in seconds
# Default TTL: 1 hour
REDIS_CACHE_TTL_DEFAULT=3600
# Short TTL: 5 minutes (for frequently changing data)
REDIS_CACHE_TTL_SHORT=300
# Long TTL: 24 hours (for rarely changing data)
REDIS_CACHE_TTL_LONG=86400

# ============================================
# MinIO / S3 Configuration
# ============================================
MINIO_ENDPOINT=localhost:9000
MINIO_ROOT_USER=miniwiki_admin
MINIO_ROOT_PASSWORD=change_this_secure_password_in_production
MINIO_BUCKET=miniwiki-files
MINIO_REGION=us-east-1
MINIO_USE_SSL=false

# ============================================
# JWT Authentication
# ============================================
# IMPORTANT: Generate a secure secret for production!
JWT_SECRET=your-super-secret-jwt-key-minimum-256-bits-long
JWT_ACCESS_EXPIRY=15m
JWT_REFRESH_EXPIRY=7d
JWT_ISSUER=miniwiki
JWT_AUDIENCE=miniwiki-users

# ============================================
# Security Configuration
# ============================================
BCRYPT_COST=12
PASSWORD_MIN_LENGTH=8
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBER=true
PASSWORD_REQUIRE_SPECIAL=true

# CSRF Protection Configuration
# Double Submit Cookie pattern for CSRF protection
CSRF_COOKIE_NAME=csrf_token
CSRF_COOKIE_MAX_AGE=3600
CSRF_HEADER_NAME=X-CSRF-Token
CSRF_TOKEN_TTL=3600
# If true, CSRF cookie will be marked Secure (sent only over HTTPS)
# Allowed values: true, false
# Default: false (automatically set to true in non-development environments)
CSRF_SECURE_COOKIE=false
# If true, fail startup if Redis is configured but unreachable
CSRF_STRICT_REDIS=false

# Rate limiting
RATE_LIMIT_ANONYMOUS=100/minute
RATE_LIMIT_AUTHENTICATED=1000/hour

# Session configuration
SESSION_EXPIRY=24h
MAX_CONCURRENT_SESSIONS=5

# ============================================
# Email Configuration (for password reset)
# ============================================
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USER=noreply@miniwiki.local
SMTP_PASSWORD=your_smtp_password
SMTP_FROM=noreply@miniwiki.local
SMTP_USE_TLS=true
EMAIL_RESET_LINK_EXPIRY=1h

# ============================================
# Application Configuration
# ============================================
APP_NAME=miniWiki
APP_URL=http://localhost:3000
APP_ENV=development
APP_DEBUG=true

# ============================================
# API Configuration
# ============================================
API_BASE_URL=http://localhost:8080/api/v1
API_VERSION=v1
API_CORS_ORIGINS=http://localhost:3000,http://localhost:8080

# CORS Development Setting
# WARNING: SECURITY RISK - DO NOT ENABLE IN PRODUCTION!
# When set to "true", enables permissive CORS (allows all origins) for development/testing.
# This maps to the allow_all_origins boolean in main.rs (std::env::var("ALLOW_ALL_ORIGINS")...).
# In production, always use proper origin whitelisting via API_CORS_ORIGINS or stricter CORS configuration.
# Allowed values: true, false
# Default: false (not set)
# ALLOW_ALL_ORIGINS=false

# ============================================
# WebSocket Configuration
# ============================================
WS_URL=ws://localhost:8080/ws

# ============================================
# File Upload Configuration
# ============================================
MAX_DOCUMENT_SIZE=10485760  # 10MB in bytes
MAX_FILE_SIZE=52428800      # 50MB in bytes
ALLOWED_FILE_TYPES=image/*,application/pdf,text/*,video/*,audio/*
FILE_UPLOAD_PATH=./uploads

# ============================================
# Logging Configuration
# ============================================
RUST_LOG=info
LOG_FORMAT=json
LOG_LEVEL=info

# ============================================
# Encryption Configuration
# ============================================
# Generate a secure 32-byte key using: openssl rand -base64 32
# This key is used for server-side encryption of sensitive data at rest.
# The key must be exactly 32 bytes (44 characters in base64) for AES-256-GCM.
ENCRYPTION_KEY=<GENERATE_WITH_OPENSSL>
ENCRYPTION_ALGORITHM=AES-256-GCM

# ============================================
# Frontend Configuration (Flutter)
# ============================================
# These are used by the Flutter app
FLUTTER_APP_API_BASE_URL=http://localhost:8080/api/v1
FLUTTER_APP_WS_URL=ws://localhost:8080/ws
FLUTTER_APP_APP_NAME=miniWiki
FLUTTER_APP_VERSION=0.1.0


# ============================================
# Docker Configuration
# ============================================
# These are used in docker-compose.yml
POSTGRES_PORT=5432
REDIS_PORT=6379
MINIO_API_PORT=9000
MINIO_CONSOLE_PORT=9001
BACKEND_PORT=8080
WEB_PORT=3000
NGINX_PORT=80
NGINX_SSL_PORT=443

# ============================================
# Development/Testing Configuration
# ============================================
TEST_DATABASE_URL=postgres://miniwiki:test123@localhost:5432/miniwiki_test
TEST_REDIS_URL=redis://localhost:6379/1
SEED_ADMIN_EMAIL=admin@miniwiki.local
SEED_ADMIN_PASSWORD=admin123
